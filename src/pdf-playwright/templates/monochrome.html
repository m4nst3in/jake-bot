<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{title}}</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    {{styles}}
  </style>
</head>
<body>
  <div class="container">
    <!-- COVER -->
    <section class="cover page-break">
      <div class="title">
        <div class="brand">Relatório — {{areaName}}</div>
        <div class="divider"></div>
        <div class="subtitle small muted">{{areaName}} • {{date}} • v{{version}}</div>
      </div>
    </section>


    <!-- WEEKLY SUMMARY (full page) -->
    <section class="section card pad full">
      <div class="h2">Resumo da Semana</div>
      <div class="hr"></div>
      <div class="stats">
        <div class="stat">
          <div class="value">{{totalParticipants}}</div>
          <div class="label">Participantes</div>
        </div>
        <div class="stat">
          <div class="value">{{totalPoints}}</div>
          <div class="label">Total de Pontos</div>
        </div>
        <div class="stat">
          <div class="value">{{avgPoints}}</div>
          <div class="label">Média</div>
        </div>
        <div class="stat">
          <div class="value">{{medianPoints}}</div>
          <div class="label">Mediana</div>
        </div>
      </div>
      <div class="hr"></div>
      <div class="card pad">
        <div class="h3">Destaques</div>
        <div class="hr"></div>
        <ul class="small">
          {{#each topParticipants}}
            {{#if @first}}
              <li><strong>Top 1:</strong> {{username}} — {{points}} pts ({{percentage}}% do total)</li>
            {{/if}}
          {{/each}}
          <li>Total de participantes ranqueados: {{totalParticipants}}</li>
          <li>Pontuação máxima individual: {{maxPoints}}</li>
        </ul>
      </div>
    </section>

    <!-- ALL PARTICIPANTS TABLE -->
    <section class="section card pad">
      <div class="h2">Todos os Participantes</div>
      <div class="hr"></div>
      <table class="table">
        <thead>
          <tr>
            <th>Pos</th>
            <th>Usuário</th>
            <th>Pontos</th>
            <th>% Total</th>
            {{#if isSupport}}
            <th>Relatórios</th>
            <th>Plantões</th>
            {{else}}
            <th>Participação</th>
            {{/if}}
          </tr>
        </thead>
        <tbody>
          {{#each topParticipants}}
          <tr>
            <td>{{add @index 1}}</td>
            <td>{{username}}</td>
            <td>{{points}}</td>
            <td>{{percentage}}%</td>
            {{#if isSupport}}
            <td>{{reports}}</td>
            <td>{{shifts}}</td>
            {{else}}
            <td>{{participation}}</td>
            {{/if}}
          </tr>
          {{/each}}
        </tbody>
      </table>
    </section>

    <!-- DETAILED ANALYSIS -->
    <section class="section">
      <div class="card pad">
        <div class="h2">5. Análise Detalhada</div>
        <div class="hr"></div>
        <div class="grid2">
          {{#each participants}}
          <div class="card person">
            <div class="head">
              {{#if avatar}}
              <img src="{{avatar}}" alt="Avatar" class="avatar-img" />
              {{else}}
              <div class="avatar">{{initials}}</div>
              {{/if}}
              <div>
                <div class="h3">{{username}}</div>
                <div class="meta">ID: {{userId}}</div>
              </div>
              <div class="badge" style="margin-left:auto;">{{badgeText}}</div>
            </div>
            <div class="hr"></div>
            <div class="score">
              <div>◆</div>
              <div class="pts">{{points}} pontos</div>
              {{#if rank}}
              <div class="tag" style="margin-left: 6px; color: {{rankTextColor}}; border-color: {{rankBorderColor}}; background: {{rankBg}};">{{rank}}</div>
              {{/if}}
            </div>
            <div class="hr"></div>
            <div class="list">
              {{#if isSupport}}
                <div class="item"><div class="ic">{{pointsIcon}}</div><div>Meta Pontos: {{pointsGoal}} {{#unless pointsGoalMet}}(faltam {{pointsNeeded}}){{/unless}}</div></div>
                {{#if reportsGoal}}
                  <div class="item"><div class="ic">{{reportsIcon}}</div><div>Relatórios: {{reports}}/{{reportsGoal}} {{#unless reportsGoalMet}}(faltam {{reportsNeeded}}){{/unless}}</div></div>
                {{/if}}
                <div class="item"><div class="ic">{{shiftsIcon}}</div><div>Plantões: {{shifts}}/{{shiftsGoal}} {{#unless shiftsGoalMet}}(faltam {{shiftsNeeded}}){{/unless}}</div></div>
              {{/if}}
              {{#if isNonSupport}}
                {{#if goal}}
                  <div class="item"><div class="ic">{{goalIcon}}</div><div>Meta: {{goal}} {{#unless goalMet}}(faltam {{goalNeeded}}){{/unless}}</div></div>
                {{/if}}
              {{/if}}
            </div>
          </div>
          {{/each}}
        </div>
      </div>
    </section>

    <div class="footer">
      <div>Relatório • {{areaName}}</div>
      <div>Página {{pageNumber}}</div>
    </div>
  </div>
</body>
</html>
